<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Welcome Sender — v15.09.0002.0001</title>
<meta name="robots" content="noindex,nofollow">
<link rel="stylesheet" href="/portal-assets/css/portal.css">
<script>
  function onModeChange(val){
    document.getElementById('csv_upload_wrap').style.display = (val==='upload') ? '' : 'none';
    document.getElementById('server_path_wrap').style.display = (val==='server') ? '' : 'none';
    document.getElementById('manual_wrap').style.display      = (val==='manual') ? '' : 'none';
  }
  document.addEventListener('DOMContentLoaded', function(){
    const radios = document.querySelectorAll('input[name="csv_mode"]');
    radios.forEach(r => r.addEventListener('change', e => onModeChange(e.target.value)));
    const checked = document.querySelector('input[name="csv_mode"]:checked');
    if (checked) onModeChange(checked.value);
  });
</script>
  <link rel="stylesheet" href="/portal-assets/css/tool.css">
</head>
<body>
  <main>
    <section class="hero tool-hero">
      <div>
        <h1>Welcome Sender</h1>
        <p class="tool-card__lede">
          Send the "Welcome to CALM" email to CSV uploads, server-side files, or a quick manual list. Supports username or email inputs plus optional greeting overrides.
        </p>
      </div>
      <div class="tool-hero__meta">
        <span class="tool-hero__pill">v15.09.0002.0001</span>
      </div>
    </section>

    <div class="tool-card">

  <form method="post" action="launch.php" enctype="multipart/form-data">
    <fieldset>
      <legend>Auth</legend>
      <label>Launcher Auth Token
        <input type="password" name="token" placeholder="paste AUTH_TOKEN (launcher)" required>
        <span class="token-hint">Launch via the CALM Admin Toolkit portal to auto-fill the token.</span>
      </label>
    </fieldset>

    <fieldset>
      <legend>Source</legend>

      <label class="row">
        <input type="radio" name="csv_mode" value="upload" checked> Upload CSV now
        <span class="pill">Recommended</span>
      </label>
      <div id="csv_upload_wrap">
        <input type="file" name="csv_file" accept=".csv">
        <div class="small muted">
          CSV must include either <code>user_email</code>/<code>email</code> OR <code>user_login</code>/<code>username</code>/<code>login</code>.<br>
          Optional: <code>name</code>/<code>full_name</code>/<code>first_name</code> for the greeting.
        </div>
      </div>

      <div style="margin:10px 0"></div>

      <label class="row">
        <input type="radio" name="csv_mode" value="server"> Use server path
      </label>
      <div id="server_path_wrap" style="display:none">
        <input type="text" name="csv_path" placeholder="/home/bulk_update/send_welcome.csv">
      </div>

      <div style="margin:10px 0"></div>

      <label class="row">
        <input type="radio" name="csv_mode" value="manual"> Manual entry (up to 5 emails)
      </label>
      <div id="manual_wrap" style="display:none">
        <textarea name="manual_emails" rows="4" placeholder="e.g. alice@example.com, bob@example.com
(or one per line)"></textarea>
        <div class="small muted">Max 5 addresses. We’ll validate and create a temporary CSV for this run.</div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Options</legend>
      <label class="row"><input type="checkbox" name="send" value="1"> Send emails (untick = dry-run preview)</label>
      <div class="row">
        <label>Limit (0 = all): <input type="text" name="limit" value="0" class="small"></label>
        <label>Only Role: <input type="text" name="only_role" placeholder="e.g. subscriber" class="small"></label>
        <label>Campaign tag: <input type="text" name="campaign" placeholder="optional" class="small"></label>
      </div>
      <div class="row">
        <label>Batch size: <input type="text" name="batch_size" value="50" class="small"></label>
        <label>Batch sleep (sec): <input type="text" name="batch_sleep" value="2" class="small"></label>
      </div>
    </fieldset>

    <div class="row" style="margin-top:12px">
      <button type="submit">Launch Background Run</button>
      <a href="status.php"><button type="button">View Runs & Logs</button></a>
    </div>
  </form>

  <p class="muted" style="margin-top:16px">
    Results CSV and live stdout are stored under <code>/srv/admin-tools/wp-welcome-sender/_mailer-logs/</code>.
  </p>
    </div>
  </main>
  <script src="/portal-assets/js/tool.js" defer></script>
</body>
</html>
