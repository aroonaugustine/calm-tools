<?php require_once __DIR__.'/bootstrap.php'; function new_run_id($slug){$ts=gmdate('Ymd_His');$r=substr(bin2hex(random_bytes(3)),0,6);return $slug.'_'.$ts.'_'.$r;} function run_path($id){return rtrim(LOG_DIR,'/').'/'.$id;} function logger_start($slug,$payload=[]){$id=new_run_id($slug);$p=run_path($id);ensure_dir($p);touch($p.'/STARTED');write_json($p.'/run.json',['tool'=>$slug,'run_id'=>$id,'started_utc'=>gmdate('c'),'status'=>'RUNNING','payload'=>$payload,'stats'=>[]]);return $id;} function logger_stdout($id,$m){$fp=fopen(run_path($id).'/stdout.log','a');fwrite($fp,'['.gmdate('H:i:s').'] '.$m.PHP_EOL);fclose($fp);} function logger_attach($id,$tmp,$as){$d=run_path($id).'/'.$as;copy($tmp,$d);return $d;} function logger_done($id,$stats=[],$status='DONE',$artifacts=[]){$p=run_path($id);touch($p.'/DONE');$m=read_json($p.'/run.json',[]);$m['status']=$status;$m['finished_utc']=gmdate('c');$m['stats']=$stats;$m['artifacts']=$artifacts;write_json($p.'/run.json',$m);return $p;}