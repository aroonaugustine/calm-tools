<?php require_once __DIR__.'/../core/bootstrap.php'; require_once __DIR__.'/../core/ui.php'; require_once __DIR__.'/../core/logger.php'; $run=null; $tail_url=''; $stats=[]; $arts=[]; if($_SERVER['REQUEST_METHOD']==='POST'){ $mode=$_POST['mode']??'csv'; $payload=['mode'=>$mode]; foreach(['action','course_id','group_id'] as $k) if(isset($_POST[$k])) $payload[$k]=trim((string)$_POST[$k]); $run=logger_start('wp-ld-tools',$payload); if($mode==='csv' && isset($_FILES['csv']) && $_FILES['csv']['tmp_name']){ logger_stdout($run,'Received CSV input'); $input=logger_attach($run,$_FILES['csv']['tmp_name'],'input.csv'); $out=run_path($run).'/report.csv'; file_put_contents($out,"note\nprocessed via wp-ld-tools demo\n"); $arts[] = basename($out); $stats=['mode'=>'csv','processed'=>42]; logger_stdout($run,'Processed 42 rows (demo).'); logger_done($run,$stats,'DONE',$arts); } else { $email=trim($_POST['email']??''); logger_stdout($run,'Single mode for: '.$email); $stats=['mode'=>'single','processed'=>1,'target'=>$email]; logger_done($run,$stats,'DONE',$arts); } $base=rtrim(dirname($_SERVER['SCRIPT_NAME']),'/'); $tail_url=$base+'/../core/logs.php?id='.urlencode($run).'#tail'; } echo ui_header('WP LearnDash Tools'); ?><div class="container"><h1>WP LearnDash Tools</h1><p class="muted">Use CSV for batch updates, or single mode for one user. Choose an action below.</p><form method="post" enctype="multipart/form-data" class="form panel"><label><strong>Mode</strong><select name="mode" id="mode" onchange="document.querySelectorAll('.mode').forEach(x=>x.hidden=true); document.querySelector('.mode-'+this.value).hidden=false;"><option value="csv">CSV Upload</option><option value="single">Single Input</option></select></label><div class="mode mode-csv"><label><strong>CSV file</strong> <input type="file" name="csv" accept=".csv"></label><div class="tips">Your existing header expectations still apply; this adapter just unifies UI + logs.</div></div><div class="mode mode-single" hidden><label><strong>Email address</strong> <input type="email" name="email" placeholder="user@example.com"></label><div class="tips">Use single mode for one-off actions.</div></div><div class="actions"><label><strong>Action</strong><select name="action"><option value="enroll-course">Enroll in Course</option><option value="remove-course">Remove from Course</option><option value="add-group">Add to Group</option><option value="remove-group">Remove from Group</option></select></label><label><strong>Course ID</strong> <input type="number" name="course_id" placeholder="e.g., 3027"></label><label><strong>Group ID</strong> <input type="number" name="group_id" placeholder="optional"></label><button class="btn" type="submit">Run</button><a class="btn" href="../core/logs.php">Open Logs</a></div></form><?php if($run): ?><div class="panel"><div>Run ID: <code><?=h($run)?></code> â€” <span class="badge ok">Submitted</span></div><div class="actions" style="margin-top:8px"><a class="btn" href="<?=$tail_url?>">View Tail</a></div></div><?php endif; ?></div><?=ui_footer();?>