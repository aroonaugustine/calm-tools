<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>LearnDash — Finish Remaining Steps (v2.3-web)</title>
  <meta name="robots" content="noindex,nofollow">
  <link rel="stylesheet" href="/portal-assets/css/portal.css">
  <style>
    body { margin: 0; }
    main { padding: 32px 24px; }
    .tool-card { margin-bottom: 24px; }
    .tool-card h3 { margin-bottom: 16px; }
    fieldset { border: 1px solid var(--border); border-radius: var(--radius); padding: 20px; margin: 20px 0; background: var(--card-bg); }
    legend { font-weight: 700; padding: 0 8px; background: var(--card-bg); border-radius: 8px; }
    label { display: block; margin: 12px 0; }
    input[type=text], input[type=password], input[type=number] { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 8px; background: white; }
    .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
    button { padding: 12px 20px; border: 1px solid var(--border); border-radius: 999px; background: var(--accent); color: white; cursor: pointer; font-weight: 600; transition: background .2s ease; }
    button:hover { background: #1d4ed8; }
    .muted { color: var(--muted); }
    code { background: var(--accent-soft); padding: 2px 6px; border-radius: 4px; }
    .token-hint { color: #dc2626; font-size: 12px; margin-top: 6px; }
  </style>
</head>
<body>
  <main>
    <div class="tool-card">
      <h3>LearnDash — Finish Remaining Steps <span class="muted">v2.3-web</span></h3>
      <p class="muted">
        Marks incomplete lessons/topics/quizzes as complete for a single user. If quizzes exist, records a 100% pass and marks the quiz step complete too. <br>
        Uses <code>wp-load.php</code> so it runs outside WP Admin. Protected with a launcher token.
      </p>

  <form method="get" action="finish_user.php" target="_blank">
    <fieldset>
      <legend>Auth</legend>
      <label>Launcher Token:
        <input type="password" name="token" placeholder="paste token" required>
      </label>
    </fieldset>

    <fieldset>
      <legend>User & Course</legend>
      <label>User (login or email):
        <input type="text" name="user" placeholder="e.g. harischandra01119 or user@example.com" required>
      </label>
      <label>Course ID (optional; blank = process all enrolled courses):
        <input type="number" name="course_id" min="0" step="1" placeholder="2869">
      </label>
      <label class="row"><input type="checkbox" name="dry_run" value="1" checked> Dry run (show actions, no writes)</label>
    </fieldset>

    <div class="row" style="margin-top:12px">
      <button type="submit">Run</button>
    </div>
  </form>

  <p class="muted" style="margin-top:16px">
    Output is plain text. Example direct URL:<br>
    <code>?user=harischandra01119&amp;dry_run=1</code> &nbsp;or&nbsp;
    <code>?user=user@example.com&amp;course_id=2869</code>
    </div>
  </main>
  <script>
    (function() {
      var params = new URLSearchParams(window.location.search);
      var token = params.get('token');
      var fields = document.querySelectorAll('input[name="token"]');

      if (!fields.length) {
        return;
      }

    if (token) {
      fields.forEach(function(field) {
        field.value = token;
        field.type = 'hidden';
        field.required = false;
        var section = field.closest('fieldset');
        if (section) {
          section.style.display = 'none';
        } else {
          var label = field.closest('label');
          if (label) {
            label.style.display = 'none';
          }
        }
      });
        return;
      }

      fields.forEach(function(field) {
        var label = field.closest('label');
        if (!label || label.querySelector('.token-hint')) {
          return;
        }
        var hint = document.createElement('div');
        hint.className = 'token-hint';
        hint.textContent = 'Launch this tool from the CALM Admin Toolkit portal to auto-fill the access token.';
        hint.style.color = '#b91c1c';
        hint.style.fontSize = '12px';
        hint.style.marginTop = '6px';
        label.appendChild(hint);
      });
    })();
  </script>
</body>
</html>
