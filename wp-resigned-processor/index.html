<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Resigned Processor — v15.09.0002.0001</title>
<meta name="robots" content="noindex,nofollow">
<link rel="stylesheet" href="../portal-assets/css/portal.css">
  <link rel="stylesheet" href="../portal-assets/css/tool.css">
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const radios = document.querySelectorAll('input[name="csv_mode"]');
      const uploadWrap = document.getElementById('upload_wrap');
      const serverWrap = document.getElementById('server_wrap');
      const manualWrap = document.getElementById('manual_wrap');
      function sync(val){
        uploadWrap.style.display = val === 'upload' ? '' : 'none';
        serverWrap.style.display = val === 'server' ? '' : 'none';
        manualWrap.style.display = val === 'manual' ? '' : 'none';
      }
      radios.forEach(r => r.addEventListener('change', e => sync(e.target.value)));
      const checked = document.querySelector('input[name="csv_mode"]:checked');
      if (checked) sync(checked.value);
    });
  </script>
</head>
<body class="portal-tool-body">
  <main class="portal-tool-shell">
    <section class="hero tool-hero">
      <div>
        <h1>Resigned Processor</h1>
        <p class="tool-card__lede">Batch unenroll resigned staff, strip roles, and clean up LearnDash relationships in a single run.</p>
      </div>
      <div class="tool-hero__meta">
        <span class="tool-hero__pill">v15.09.0002.0001</span>
      </div>
    </section>

    <div class="tool-card">
      <form method="post" action="launch.php" enctype="multipart/form-data">
    <input type="hidden" name="token" data-token-input>

    <fieldset>
      <legend>CSV Source</legend>
      <label class="row"><input type="radio" name="csv_mode" value="upload" checked> Upload CSV</label>
      <div id="upload_wrap">
        <input type="file" name="csv_file" accept=".csv">
      </div>
      <div style="height:10px"></div>
      <label class="row"><input type="radio" name="csv_mode" value="server"> Use server path</label>
      <div id="server_wrap" style="display:none">
        <input type="text" name="csv_path" placeholder="/home/bulk_update/Resigned.csv">
        <div class="small muted">Tip: “Server path” avoids Cloudflare timeouts for very large files.</div>
      </div>
      <div style="height:10px"></div>
      <label class="row"><input type="radio" name="csv_mode" value="manual"> Manual list (up to 10 usernames/emails)</label>
      <div id="manual_wrap" style="display:none">
        <textarea name="manual_list" rows="6" placeholder="one per line, e.g. alice@example.com&#10;username123"></textarea>
        <div class="small muted">We’ll generate a temporary CSV for this run (10 max). Manual mode matches by email or username.</div>
      </div>
    </fieldset>

    <fieldset>
      <legend>Matching Policy</legend>
      <label class="row"><input type="radio" name="match_mode" value="strict" checked> <b>Strict</b> — email + (NIC OR Passport) must match the same WP user</label>
      <label class="row"><input type="radio" name="match_mode" value="email"> <b>Email only</b> — match by email only</label>
      <label class="row"><input type="radio" name="match_mode" value="id"> <b>NIC/Passport only</b> — match by NIC or Passport only</label>
      <div class="small muted">Worker receives <code>--match=strict</code>, <code>--match=email</code>, or <code>--match=id</code>.</div>
    </fieldset>

    <fieldset>
      <legend>Batching (avoid 504s)</legend>
      <label>Batch size (rows per chunk, header excluded):
        <input type="number" min="0" step="1" name="batch_size" value="0">
      </label>
      <div class="small muted">0 = no batching. Try 200–1000 if you’re hitting timeouts.</div>
      <label>Delay between chunks (ms):
        <input type="number" min="0" step="50" name="batch_delay_ms" value="250">
      </label>
      <div class="small muted">Adds a small pause between chunks to reduce DB and PHP load (optional).</div>
    </fieldset>

    <fieldset>
      <legend>Options</legend>
      <label class="row"><input type="checkbox" name="live" value="1"> Live run (apply changes). Untick = DRY RUN (preview only).</label>
      <label class="row"><input type="checkbox" name="remove_groups" value="1" checked> Remove from all LearnDash groups</label>
      <label class="row"><input type="checkbox" name="unenroll_courses" value="1"> Unenroll from all LearnDash courses</label>
      <label class="row" style="margin-left:24px"><input type="checkbox" name="reset_progress" value="1"> …and reset course progress</label>
      <label class="row"><input type="checkbox" name="um_inactive" value="1"> Set Ultimate Member account_status = inactive</label>
      <label class="row"><input type="checkbox" name="strip_roles" value="1"> Strip all WordPress roles (fallback if you don’t have an “inactive” role)</label>
      <div class="row">
        <label>Limit (0 = all):
          <input type="number" name="limit" value="0" class="small">
        </label>
      </div>
    </fieldset>

    <div class="row" style="margin-top:12px">
      <button type="submit">Launch Background Run</button>
      <a href="status.php"><button type="button">View Runs & Logs</button></a>
    </div>
  </form>
    </div>
  </main>
  <script src="../portal-assets/js/tool.js" defer></script>
</body>
</html>
